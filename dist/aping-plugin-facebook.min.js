
/*! aping-plugin-facebook v0.1.10 (21-12-2015) by Jonathan Hornung */
"use strict";var jjtApingFacebook=angular.module("jtt_aping_facebook",["jtt_facebook"]).directive("apingFacebook",["apingFacebookHelper","apingUtilityHelper","facebookFactory",function(a,b,c){return{require:"?aping",restrict:"A",replace:"false",link:function(d,e,f,g){var h=g.getAppSettings(),i=b.parseJsonFromAttributes(f.apingFacebook,a.getThisPlattformString(),h);i.forEach(function(d){var e={model:h.model};"undefined"!=typeof h.getNativeData?e.getNativeData=h.getNativeData:e.getNativeData=!1;var f={page:d.page,access_token:b.getApiCredentials(a.getThisPlattformString(),"access_token")};if("undefined"!=typeof d.items?f.limit=d.items:f.limit=h.items,0==f.limit)return!1;if((f.limit<0||isNaN(f.limit))&&(f.limit=void 0),f.limit>100&&(f.limit=100),d.page)switch(h.model){case"social":c.getPostsFromPageById(f).success(function(b){b&&g.concatToResults(a.getObjectByJsonData(b,h))});break;case"video":c.getVideosFromPageById(f).success(function(b){b&&g.concatToResults(a.getObjectByJsonData(b,h))});break;case"image":c.getPhotosFromPageById(f).success(function(b){b&&g.concatToResults(a.getObjectByJsonData(b,h))});break;case"event":c.getEventsFromPageById(f).success(function(b){b&&g.concatToResults(a.getObjectByJsonData(b,h))})}})}}}]);jjtApingFacebook.service("apingFacebookHelper",["apingModels","apingTimeHelper","apingUtilityHelper",function(a,b,c){this.getThisPlattformString=function(){return"facebook"},this.getThisPlattformLink=function(){return"https://facebook.com/"},this.getObjectByJsonData=function(a,b){var c=[];if(a){var d=this;a.data&&angular.forEach(a.data,function(a,e){var f;f=b.getNativeData===!0||"true"===b.getNativeData?a:d.getItemByJsonData(a,b.model),f&&c.push(f)})}return c},this.getItemByJsonData=function(a,b){var c={};if(a&&b)switch(b){case"social":c=this.getSocialItemByJsonData(a);break;case"video":c=this.getVideoItemByJsonData(a);break;case"image":c=this.getImageItemByJsonData(a);break;case"event":c=this.getEventItemByJsonData(a);break;default:return!1}return c},this.getSocialItemByJsonData=function(c){var d=a.getNew("social",this.getThisPlattformString());switch($.extend(!0,d,{blog_name:c.from.name,blog_id:c.from.id,blog_link:this.getThisPlattformLink()+c.from.id+"/",intern_type:c.type,intern_id:c.id,img_url:c.full_picture,timestamp:b.getTimestampFromDateString(c.created_time,1e3,36e5)}),d.date_time=new Date(d.timestamp),c.type){case"photo":d.type="image",d.post_url=c.link,d.text=c.message;break;case"status":d.type="post";break;case"link":d.type="link",d.post_url=this.getThisPlattformLink()+c.id+"/",d.content_url=c.link,d.caption=c.name;break;case"video":d.type="video",c.name&&(d.caption=c.name);break;case"event":d.type="event",d.text=c.description,d.caption=c.caption||c.name||!1}return d.text||(d.text=c.message),d.text||(d.text=c.name),d.post_url||(c.id?d.post_url=this.getThisPlattformLink()+c.id+"/":d.post_url=c.link),d},this.getVideoItemByJsonData=function(c){var d=a.getNew("video",this.getThisPlattformString());return $.extend(!0,d,{blog_name:c.from.name,blog_id:c.from.id,blog_link:this.getThisPlattformLink()+c.from.id+"/",intern_id:c.id,post_url:c.permalink_url,timestamp:b.getTimestampFromDateString(c.created_time,1e3,36e5),text:c.description,markup:c.embed_html||!1,source:c.source||!1}),d.date_time=new Date(d.timestamp),c.format.length>0&&(c.format.length>=3?d.img_url=c.format[2].picture:d.img_url=c.format[c.format.length-1].picture),d},this.getImageItemByJsonData=function(c){var d=a.getNew("image",this.getThisPlattformString());return $.extend(!0,d,{blog_name:c.from.name,blog_id:c.from.id,blog_link:this.getThisPlattformLink()+c.from.id+"/",intern_id:c.id,post_url:c.link,timestamp:b.getTimestampFromDateString(c.created_time,1e3,36e5),text:c.name||!1,source:c.images||!1}),d.date_time=new Date(d.timestamp),c.images.length>0&&(c.images.length>=7?d.img_url=c.images[2].source:d.img_url=c.images[0].source),d},this.getEventItemByJsonData=function(c){var d=a.getNew("event",this.getThisPlattformString());return $.extend(!0,d,{blog_name:c.owner.name,blog_id:c.owner.id,blog_link:this.getThisPlattformLink()+c.owner.id+"/",intern_id:c.id,event_url:this.getThisPlattformLink()+c.owner.id+"_"+c.id+"/",ticket_url:c.ticket_uri||!1,start_timestamp:b.getTimestampFromDateString(c.start_time,1e3,36e5),end_timestamp:c.end_time?b.getTimestampFromDateString(c.end_time,1e3,36e5):!1,caption:c.name||!1,text:c.description||!1,img_url:c.cover?c.cover.source:!1}),d.start_date_time&&(d.start_date_time=new Date(d.start_timestamp)),d.end_timestamp&&(d.end_date_time=new Date(d.end_timestamp)),c.place&&(d.place_name=c.place.name||!1,c.place.location&&(d.city=c.place.location.city||!1,d.country=c.place.location.country||!1,d.latitude=c.place.location.latitude||!1,d.longitude=c.place.location.longitude||!1,d.street=c.place.location.street||!1,d.zip=c.place.location.zip||!1)),d}}]),angular.module("jtt_facebook",[]).factory("facebookFactory",["$http","facebookSearchDataService",function(a,b){var c={};return c.getPostsFromPageById=function(c){var d=b.getNew("postsFromPageById",c);return a({method:"GET",url:d.url,params:d.object})},c.getPhotosFromPageById=function(c){var d=b.getNew("photosFromPageById",c);return a({method:"GET",url:d.url,params:d.object})},c.getVideosFromPageById=function(c){var d=b.getNew("videosFromPageById",c);return a({method:"GET",url:d.url,params:d.object})},c.getEventsFromPageById=function(c){var d=b.getNew("eventsFromPageById",c);return a({method:"GET",url:d.url,params:d.object})},c.getPageById=function(c){var d=b.getNew("pageById",c);return a({method:"GET",url:d.url,params:d.object})},c}]).service("facebookSearchDataService",function(){this.getApiBaseUrl=function(a){var b;return b=a&&"undefined"!=typeof a.version?a.version+"/":"v2.5/","https://graph.facebook.com/"+b},this.fillDataInObjectByList=function(a,b,c){return angular.forEach(c,function(c,d){"undefined"!=typeof b[c]&&(a.object[c]=b[c])}),a},this.getNew=function(a,b){var c={object:{access_token:b.access_token||void 0},url:""};switch("undefined"!=typeof b.limit&&(c.object.limit=b.limit),a){case"postsFromPageById":c.object.fields="id,message,story,created_time,full_picture,from,link,description,type,shares,source,picture,object_id",c=this.fillDataInObjectByList(c,b,["__paging_token","until","since","__previous"]),c.url=this.getApiBaseUrl()+b.page+"/posts?";break;case"photosFromPageById":c.object.fields="id,created_time,from,link,picture,album,name,images",c=this.fillDataInObjectByList(c,b,["before","after"]),c.url=this.getApiBaseUrl()+b.page+"/photos?";break;case"videosFromPageById":c.object.fields="id,created_time,from,description,source,picture,format,title,embed_html,permalink_url",c=this.fillDataInObjectByList(c,b,["before","after"]),c.url=this.getApiBaseUrl()+b.page+"/videos?";break;case"eventsFromPageById":c.object.fields="id,owner,description,picture{url},end_time,name,cover,category,place,start_time,ticket_uri",c=this.fillDataInObjectByList(c,b,["before","after"]),c.url=this.getApiBaseUrl()+b.page+"/events?";break;case"pageById":c.object.fields="cover,link,picture{url},username,name",c.object.limit=void 0,c.url=this.getApiBaseUrl()+b.page+"/"}return c}});